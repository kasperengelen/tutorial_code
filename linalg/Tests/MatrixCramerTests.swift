
import XCTest
@testable import LinAlgTutorials

/// Tests for Cramer's rule
final class MatrixCramerTests: XCTestCase {
    public func testCramer2x2() {
        let mat1 = Matrix(rows: [[-0.682722791904605, -0.730677486593081], [-0.730677486593081, 0.6827227919046047]])
        let b1 = [0.86345338, 0.08052696]
        let x1 = mat1.solveWithCramer(b: b1)
        XCTAssertEqual(x1[0], -0.64833854, accuracy: 0.00001)
        XCTAssertEqual(x1[1], -0.57592836, accuracy: 0.00001)


        let mat2 = Matrix(rows: [[-0.8402426755702392, -0.5422105182957687], [-0.5422105182957687, 0.840242675570239]])
        let b2 = [0.380050942271666, 0.40971728388515494]
        let x2 = mat2.solveWithCramer(b: b2)
        XCTAssertEqual(x2[0], -0.5414880414374394, accuracy: 0.00001)
        XCTAssertEqual(x2[1], 0.13819432845111848, accuracy: 0.00001)


        let mat3 = Matrix(rows: [[-0.012688624719055852, -0.9999194961609355], [-0.9999194961609355, 0.012688624719055783]])
        let b3 = [0.2706858289799512, 0.4802920490340796]
        let x3 = mat3.solveWithCramer(b: b3)
        XCTAssertEqual(x3[0], -0.4836880145809533, accuracy: 0.00001)
        XCTAssertEqual(x3[1], -0.2645697921657981, accuracy: 0.00001)
    }

    public func testCramer3x3() {

        let mat1 = Matrix(rows: [
            [-0.24849480260473378, -0.04485272395732477, -0.9675942156875696], 
            [-0.2983834146700041, -0.9468064671191838, 0.12051909255864073], 
            [-0.9215300705502254, 0.31866243420726237, 0.22189317722002883]
        ])
        let b1 = [0.5378048304240508, 0.7999146157265905, 0.08218499097305454]
        let x1 = mat1.solveWithCramer(b: b1)
        XCTAssertEqual(x1[0], -0.4480589001906091, accuracy: 0.00001)
        XCTAssertEqual(x1[1], -0.7552970736362431, accuracy: 0.00001)
        XCTAssertEqual(x1[2], -0.4057355707085724, accuracy: 0.00001)

        let mat2 = Matrix(rows: [
            [-0.8648930448572314, 0.3831253002399982, -0.3243069923291793], 
            [-0.40199798055296276, -0.9155906356307172, -0.009560940156640232], 
            [-0.30059548331424885, 0.12210156535176092, 0.9459035696886459]
        ])
        let b2 = [0.5332590871726955, 0.5664437256330213, 0.4228743270288192]
        let x2 = mat2.solveWithCramer(b: b2)
        XCTAssertEqual(x2[0], -0.8160354221183672, accuracy: 0.00001)
        XCTAssertEqual(x2[1], -0.262691905645332, accuracy: 0.00001)
        XCTAssertEqual(x2[2], 0.22164295021018168, accuracy: 0.00001)


        let mat3 = Matrix(rows: [
            [-0.7703987872663494, 0.5336705167649993, 0.3488287375121444], 
            [-0.4324554528545039, -0.03538161834317322, -0.9009608328777804], 
            [-0.4684741080091237, -0.8449520226730014, 0.2580466808658066]
        ])
        let b3 = [0.5739911593689245, 0.37888282184814215, 0.15539307069423147]
        let x3 = mat3.solveWithCramer(b: b3)
        XCTAssertEqual(x3[0], -0.6788496655648346, accuracy: 0.00001)
        XCTAssertEqual(x3[1], 0.16161698184708, accuracy: 0.00001)
        XCTAssertEqual(x3[2], -0.10103530514739975, accuracy: 0.00001)
    }

    public func testCramer5x5() {

        let mat1 = Matrix(rows: [
            [-0.510821877704196, -0.23146599743362492, 0.7268610020103013, 0.2991111224308708, 0.26017325282500015], 
            [-0.4920343649517501, -0.33116542989289904, -0.561651278287717, 0.5072505154980532, -0.2747296814599971], 
            [-0.46492866004271444, 0.8385006129787308, 0.04371019412416609, -0.007189375648474457, -0.2807058868506167], 
            [-0.48067070315399674, -0.3134213140665745, -0.05961394586955054, -0.8065974413849342, -0.12872256999984064], 
            [-0.22306996473217883, 0.18824651922142524, -0.38827377163780163, -0.0507772724175528, 0.8726214446708218]
        ])
        let b1 = [0.30664762236532206, 0.49231351282172975, 0.38625419947033834, 0.06576432402955268, 0.5531054123785161]
        let x1 = mat1.solveWithCramer(b: b1)
        XCTAssertEqual(x1[0], -0.7334503169903873, accuracy: 0.00001)
        XCTAssertEqual(x1[1], 0.17336689692110172, accuracy: 0.00001)
        XCTAssertEqual(x1[2], -0.2554118651283168, accuracy: 0.00001)
        XCTAssertEqual(x1[3], 0.25754055144952254, accuracy: 0.00001)
        XCTAssertEqual(x1[4], 0.3102908384153808, accuracy: 0.00001)

        let mat2 = Matrix(rows: [
            [-0.5852064510531763, -0.562239725954197, 0.009680732206638324, -0.004467678051116191, 0.5842141931530511], 
            [-0.21126772964928928, -0.18137874869470427, -0.6298410167198413, 0.6230092075465121, -0.3709818282616573], 
            [-0.7442453279219602, 0.5913780399725572, 0.24551705635509158, 0.060827938877663475, -0.1799784503633044], 
            [-0.15970471087059, -0.5435028365603661, 0.37821769329629573, -0.24158153562161602, -0.6911503527459912], 
            [-0.18300998127603954, 0.07658276940634302, -0.6323601257176327, -0.7414700875043412, -0.10481033785883385]
        ])
        let b2 = [0.5912422542410952, 0.19480973744392582, 0.20964786042264982, 0.998539325355924, 0.019193591265421972]
        let x2 = mat2.solveWithCramer(b: b2)
        XCTAssertEqual(x2[0], -0.7061692859158425, accuracy: 0.00001)
        XCTAssertEqual(x2[1], -0.785012146001051, accuracy: 0.00001)
        XCTAssertEqual(x2[2], 0.3000245989122435, accuracy: 0.00001)
        XCTAssertEqual(x2[3], -0.12398091004841084, accuracy: 0.00001)
        XCTAssertEqual(x2[4], -0.45674334681726364, accuracy: 0.00001)
    }
}
